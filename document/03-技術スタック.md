# 03. 技術スタック

[[02-システム構成|← 前へ]] | [[00-INDEX|目次]] | [[04-アバター表示機能|次へ →]]

---

## 3.1 技術スタック一覧

### フロントエンド

| カテゴリ | 技術 | バージョン | 用途 |
|---------|------|-----------|------|
| ビルドツール | Vite | 5.x | 高速ビルド・HMR |
| フレームワーク | React | 18.x | UI構築 |
| 言語 | TypeScript | 5.x | 型安全性 |
| 3Dレンダリング | Three.js | r158+ | WebGL制御 |
| アバター | @pixiv/three-vrm | 2.0+ | VRMローダー |
| アニメーション | GSAP | 3.x | 滑らかなアニメーション |
| 状態管理 | Zustand | 4.x | グローバルステート |
| HTTP通信 | Axios | 1.x | API通信 |

### バックエンド

| カテゴリ | 技術 | バージョン | 用途 |
|---------|------|-----------|------|
| 言語 | Python | 3.11+ | サーバーサイド |
| フレームワーク | FastAPI | 0.104+ | REST API |
| AI | OpenAI API | GPT-4 | 対話生成 |
| TTS | Google Cloud TTS | - | 音声合成 |
| リップシンク | Rhubarb Lip Sync | - | 音素抽出 |
| HTTP通信 | httpx | 0.25+ | 非同期HTTP |
| 環境変数 | python-dotenv | 1.0+ | 設定管理 |

### 開発ツール

| カテゴリ | 技術 | 用途 |
|---------|------|------|
| パッケージ管理(FE) | npm | 依存関係管理 |
| パッケージ管理(BE) | pip | 依存関係管理 |
| リンター(FE) | ESLint | コード品質 |
| フォーマッター(FE) | Prettier | コード整形 |
| リンター(BE) | Ruff | コード品質 |
| フォーマッター(BE) | Black | コード整形 |
| テスト(FE) | Vitest | 単体テスト |
| テスト(BE) | Pytest | 単体テスト |
| バージョン管理 | Git | ソース管理 |

## 3.2 技術選定理由

### なぜ Vite + React?

**Vite を選んだ理由:**
```
✓ Three.jsとの相性が最高
✓ HMRが爆速（アニメーション調整に最適）
✓ シンプルな設定
✓ 軽量で高速なビルド
✓ 多くのThree.jsサンプルがVite使用
```

**Next.jsではなくViteを選んだ理由:**
- SSR/SSG不要（SPA構成）
- アニメーション開発でリロード頻度が高い
- バックエンド分離のメリット
- 詳細は [[01-プロジェクト概要|プロジェクト概要]]参照

### なぜ Three.js + VRM?

**Three.js:**
```
✓ 業界標準のWebGL ライブラリ
✓ 豊富なドキュメント・コミュニティ
✓ パフォーマンスが優秀
✓ 拡張性が高い
```

**VRM:**
```
✓ アニメ調3Dアバターの統一規格
✓ 日本発の規格で日本語リソース豊富
✓ BlendShape（表情）サポート
✓ アニメーション互換性が高い
```

関連: [[04-アバター表示機能|アバター表示機能]]

### なぜ FastAPI?

```
✓ Python AIライブラリとの親和性
✓ 非同期処理のサポート
✓ 自動APIドキュメント生成
✓ 型ヒントによる堅牢性
✓ 高速（Starlette + Pydantic）
```

関連: [[10-API仕様|API仕様]]

### なぜ OpenAI GPT-4?

```
✓ 高品質な自然言語生成
✓ 感情分析が可能
✓ 文脈理解が優秀
✓ 日本語対応が良好
```

関連: [[06-AI対話機能|AI対話機能]]

### なぜ Google Cloud TTS?

```
✓ 自然な音声品質（WaveNet）
✓ 日本語音声が優秀
✓ APIが使いやすい
✓ 月100万文字まで無料枠
```

関連: [[05-アニメーション機能#リップシンク|リップシンク]]

## 3.3 依存関係

### フロントエンド package.json

```json
{
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "three": "^0.158.0",
    "@pixiv/three-vrm": "^2.0.0",
    "gsap": "^3.12.0",
    "zustand": "^4.4.0",
    "axios": "^1.6.0"
  },
  "devDependencies": {
    "@types/react": "^18.2.0",
    "@types/three": "^0.158.0",
    "typescript": "^5.2.0",
    "vite": "^5.0.0",
    "vitest": "^1.0.0",
    "eslint": "^8.50.0",
    "prettier": "^3.0.0"
  }
}
```

### バックエンド requirements.txt

```txt
fastapi==0.104.1
uvicorn[standard]==0.24.0
pydantic==2.5.0
python-dotenv==1.0.0
httpx==0.25.2
openai==1.3.0
google-cloud-texttospeech==2.14.0
pytest==7.4.0
ruff==0.1.0
black==23.10.0
```

## 3.4 開発環境セットアップ

### フロントエンド

```bash
# プロジェクト作成
npm create vite@latest ai-avatar-frontend -- --template react-ts

# 依存関係インストール
cd ai-avatar-frontend
npm install three @pixiv/three-vrm gsap zustand axios

# 開発サーバー起動
npm run dev
# → http://localhost:5173
```

### バックエンド

```bash
# 仮想環境作成
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 依存関係インストール
pip install -r requirements.txt

# 開発サーバー起動
uvicorn app.main:app --reload --port 8000
# → http://localhost:8000
```

詳細は [[11-ファイル構成|ファイル構成]]を参照

## 3.5 外部サービス設定

### OpenAI API

```bash
# .env
OPENAI_API_KEY=sk-...
OPENAI_MODEL=gpt-4
```

### Google Cloud TTS

```bash
# .env
GOOGLE_APPLICATION_CREDENTIALS=path/to/service-account.json
```

設定方法:
1. Google Cloud Consoleでプロジェクト作成
2. Text-to-Speech API有効化
3. サービスアカウント作成
4. 認証情報JSONダウンロード

## 3.6 ブラウザ互換性

### 対応ブラウザ

```
✓ Chrome 100+
✓ Firefox 100+
✓ Safari 15+
✓ Edge 100+
```

### 必須機能

```
- WebGL 2.0
- ES2020+
- Web Audio API
- Fetch API
```

詳細は [[08-非機能要件#互換性|非機能要件]]を参照

## 3.7 パフォーマンス考慮事項

### 最適化ライブラリ

| ライブラリ | 用途 | 効果 |
|-----------|------|------|
| vite-plugin-compression | Gzip圧縮 | バンドルサイズ削減 |
| three/examples/jsm/loaders/DRACOLoader | 3D圧縮 | モデルサイズ削減 |
| workbox | Service Worker | キャッシュ戦略 |

関連: [[08-非機能要件#パフォーマンス|非機能要件]]

## 3.8 関連ドキュメント

- [[02-システム構成|システム構成]] - アーキテクチャ全体像
- [[11-ファイル構成|ファイル構成]] - プロジェクト構造
- [[14-デプロイメント|デプロイメント]] - 本番環境設定

---

**タグ**: #技術スタック #開発環境 #依存関係
**更新日**: 2025-10-30
